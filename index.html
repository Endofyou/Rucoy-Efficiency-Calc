<!DOCTYPE html>
<html lang="en-US">

<head>
  <title>Rucoy Training Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/x-icon" href="./rucoy_background.ico">
</head>

<body>

  <div id="header">
    <h1>Rucoy Training Calculator</h1>
  </div>

  <p id="description">
    Input into the following fields the corresponding information to receive training insights.
  </p>

  <div id="mainContent">

    <input type="checkbox" id="enablePt" onclick="enablePtrain()">
    <label for="enablePt">Enable Power Training</label>

    <p id="mageToggle">
      <input type="checkbox" id="magePt">
      <label for="magePt">Enable Magic</label>
    </p>

    <p>Base Level: <input type="number" id="box1" value=""></p>
    <p>Skill Level: <input type="number" id="box2" value=""></p>
    <p>Extra Equips: <input type="number" id="box3" value="0"></p>
    <p>Weapon Attack: <input type="number" id="box4" value=""></p>

    <input type="checkbox" id="advancedToggle" onclick="advancedOptions()">
    <label for="advancedToggle">Advanced Options</label>

    <div id="advancedBoxes">
      <p>target % efficiency: <input type="number" id="box5" value="90"></p>
      <p>% Crit Chance: <input type="number" id="box6" value="1"></p>
      <p>Crit Multiplier: <input type="number" id="box7" value="1.05"></p>
      <p>Magic Multiplier: <input type="number" id="box8" value="1.08"></p>
    </div>
    
  </div>

  <p><button type="button" onclick="calculation()">Calculate</button></p>

  <div id="results">
    <div id="resultsText1">[Results will display here]</div>
    <div id="resultsText2"></div>
  </div>

  <br>

  <script>
    document.getElementById("mageToggle").style.display = "none"
    document.getElementById("advancedBoxes").style.display = "none"

    function enablePtrain() {
      document.getElementById("enablePt").checked == true
      ? document.getElementById("mageToggle").style.display = "block"
      : document.getElementById("mageToggle").style.display = "none"
    }

    function advancedOptions() {
      document.getElementById("advancedToggle").checked == true
      ? document.getElementById("advancedBoxes").style.display = "block"
      : document.getElementById("advancedBoxes").style.display = "none"
    }

    function calculation() {
      const base = +document.getElementById("box1").value
      const stat = +document.getElementById("box2").value
      const equips = +document.getElementById("box3").value
      const att = +document.getElementById("box4").value
      const targetEff = +document.getElementById("box5").value
      const crit = +document.getElementById("box6").value / 100
      const critMulti = +document.getElementById("box7").value
      const magicMulti = +document.getElementById("box8").value
      const ptrain = +document.getElementById("enablePt").checked ? true : false
      const magic = +document.getElementById("magePt").checked ? true : false

      if (
        base < 1 || base > 1000 ||
        stat < 5 || stat > 1000 ||
        equips < -50 || equips > 76 ||
        att < 4 || att > 60 ||
        targetEff < 0 || targetEff > 99 ||
        crit < 0 || crit > 100 ||
        critMulti < 1 || critMulti > 2 ||
        magicMulti < 1 || magicMulti > 2
      ) {
        document.getElementById("resultsText1").innerHTML = "ERROR: Please ensure all fields are properly filled with valid entries."
        document.getElementById("resultsText2").innerHTML = ""
        return
      }

      const totalStat = stat + equips
      const ticks = ptrain == true ? 38 : 10
      const specMulti = (ptrain == true ? 1.5 * (magic == true ? magicMulti : 1) : 1)
      const min = specMulti * (Math.floor(base / 4) + att * totalStat / 20)
      const max = specMulti * (Math.floor(base / 4) + att * totalStat / 10)
      const avgCritMulti = 1 + (critMulti - 1) / 2
      const targetProb = 1 - ((100 - targetEff) / 100) ** (1 / ticks)

      const mobArray = [
        { name:                  "Rat Lv.1", def:   4, hp:   25, ptrain: false },
        { name:                  "Rat Lv.3", def:   7, hp:   35, ptrain: false },
        { name:                 "Crow Lv.6", def:  13, hp:   40, ptrain: false },
        { name:                 "Wolf Lv.9", def:  17, hp:   50, ptrain: false },
        { name:            "Scorpion Lv.12", def:  18, hp:   50, ptrain: false },
        { name:               "Cobra Lv.13", def:  18, hp:   50, ptrain: false },
        { name:                "Worm Lv.14", def:  19, hp:   55, ptrain: false },
        { name:              "Goblin Lv.15", def:  21, hp:   60, ptrain:  true },
        { name:               "Mummy Lv.25", def:  36, hp:   80, ptrain:  true },
        { name:             "Pharaoh Lv.35", def:  51, hp:  100, ptrain:  true },
        { name:            "Assassin Lv.45", def:  71, hp:  120, ptrain:  true },
        { name:            "Assassin Lv.50", def:  81, hp:  140, ptrain:  true },
        { name:      "Assassin Ninja Lv.55", def:  91, hp:  160, ptrain:  true },
        { name:     "Skeleton Archer Lv.80", def: 101, hp:  300, ptrain: false },
        { name:              "Zombie Lv.65", def: 106, hp:  200, ptrain:  true },
        { name:            "Skeleton Lv.75", def: 121, hp:  300, ptrain:  true },
        { name:    "Skeleton Warrior Lv.90", def: 146, hp:  375, ptrain:  true },
        { name:            "Vampire Lv.100", def: 171, hp:  450, ptrain:  true },
        { name:            "Vampire Lv.110", def: 186, hp:  530, ptrain:  true },
        { name:        "Drow Ranger Lv.125", def: 191, hp:  600, ptrain: false },
        { name:          "Drow Mage Lv.130", def: 191, hp:  600, ptrain: false },
        { name:      "Drow Assassin Lv.120", def: 221, hp:  620, ptrain:  true },
        { name:     "Drow Sorceress Lv.140", def: 221, hp:  600, ptrain: false },
        { name:       "Drow Fighter Lv.135", def: 246, hp:  680, ptrain:  true },
        { name:      "Lizard Archer Lv.160", def: 271, hp:  650, ptrain: false },
        { name:      "Lizard Shaman Lv.170", def: 276, hp:  600, ptrain: false },
        { name:          "Dead Eyes Lv.170", def: 276, hp:  600, ptrain: false },
        { name:     "Lizard Warrior Lv.150", def: 301, hp:  680, ptrain:  true },
        { name:              "Djinn Lv.150", def: 301, hp:  640, ptrain:  true },
        { name: "Lizard High Shaman Lv.190", def: 326, hp:  740, ptrain: false },
        { name:           "Gargoyle Lv.190", def: 326, hp:  740, ptrain:  true },
        { name:     "Lizard Captain lv.180", def: 361, hp:  815, ptrain:  true },
        { name:           "Minotaur Lv.225", def: 511, hp: 4250, ptrain:  true },
        { name:           "Minotaur Lv.250", def: 601, hp: 5000, ptrain:  true },
        { name:           "Minotaur Lv.275", def: 691, hp: 5750, ptrain:  true },
      ]

      let targetMob = 0
      let nextMob = 0
      let reqStats = 0
      let duration = 0
      for (let i = 0; i < mobArray.length; i++) {
        if (ptrain == true && mobArray[i].ptrain == false) { continue }
          const prob = Math.min((1 - crit) * (max - mobArray[i].def) / (max - min) + crit, 1)
        if (targetProb < prob) {
          const durationCheck = min < mobArray[i].def
          ? mobArray[i].hp / (
            crit * (max * avgCritMulti - mobArray[i].def) +
            (1 - crit) * (max - mobArray[i].def) * prob / 2
            )
          : mobArray[i].hp / (
            crit * (max * avgCritMulti - mobArray[i].def) +
            (1 - crit) * (max + min - 2 * mobArray[i].def) / 2
            )
          if (duration < durationCheck) {
            duration = durationCheck
            targetMob = mobArray[i].name
          } else if (duration == durationCheck) {
            targetMob += " & " + mobArray[i].name
          }
        } else {
          nextMob = mobArray[i].name
          reqStats = Math.ceil(
            (20 * mobArray[i].def - 20 * Math.floor(base / 4) * specMulti) /
            (att * specMulti * (2 - (targetProb - crit) / (1 - crit)))
            ) - totalStat
          break
        }
      }

      if (targetMob != 0) {
        document.getElementById("resultsText1").innerHTML = "You can effectively " + (ptrain == true ? "ptrain " : "train ") + targetMob + " for an average duration of " + Math.round(duration) + " seconds."
      } else {
        document.getElementById("resultsText1").innerHTML = "There are no mobs you can train at your level."
      }
      if (nextMob != 0) {
        document.getElementById("resultsText2").innerHTML = " You can start training " + nextMob + " with " + targetEff + "% efficiency after " + reqStats + " more stat(s)."
      } else {
        document.getElementById("resultsText2").innerHTML = ""
      }
    }
  </script>

</body>

</html>
